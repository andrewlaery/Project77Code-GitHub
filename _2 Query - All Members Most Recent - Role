
-- Creates a table showing all current members and when they last performed a role.

SET @ClubsID = '1';
SET @CurrentMember = 'Yes';

DROP TABLE IF EXISTS TTX_MEMBER_ROLE_RANK0;
CREATE TABLE TTX_MEMBER_ROLE_RANK0
	(
		id SERIAL ,

		MembersID INT ,
		NameFull VARCHAR(255) ,
		RolesID INT ,
		Role VARCHAR(255) ,
		Date1 DATE
	);

INSERT INTO TTX_MEMBER_ROLE_RANK0
	(
		MembersID ,
		NameFull ,
		RolesID ,
		Role ,
		Date1
	)
	SELECT
		TX_CONTESTABLE_TMIROLES_TO_MEMBERS0.MembersID ,
		TX_CONTESTABLE_TMIROLES_TO_MEMBERS0.NameFull ,
		TX_CONTESTABLE_TMIROLES_TO_MEMBERS0.RolesID ,
		TX_CONTESTABLE_TMIROLES_TO_MEMBERS0.Role ,
		TX_MOSTRECENTROLE0.Date1
	FROM TX_CONTESTABLE_TMIROLES_TO_MEMBERS0
	LEFT JOIN TX_MOSTRECENTROLE0 ON TX_MOSTRECENTROLE0.MembersID_RolesID = TX_CONTESTABLE_TMIROLES_TO_MEMBERS0.MembersID_RolesID
	WHERE
		TX_CONTESTABLE_TMIROLES_TO_MEMBERS0.ClubsID = @ClubsID
		AND TX_CONTESTABLE_TMIROLES_TO_MEMBERS0.CurrentMember = @CurrentMember
	ORDER BY RolesID , Date1;

SELECT * FROM TTX_MEMBER_ROLE_RANK0;
